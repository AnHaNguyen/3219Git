<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8"> 
	<link href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/css/bootstrap-combined.min.css" rel="stylesheet">
	<link rel="stylesheet" type="text/css" media="screen" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.9.3/css/bootstrap-select.min.css">
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
	<script src="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/js/bootstrap.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.9.3/js/bootstrap-select.min.js"></script>
	<script src="https://d3js.org/d3.v4.min.js"></script>
</head>
<body>
	
<div class="container">

<div class="row">	
	<select class="selectpicker" title = "first user" data-live-search="true" data-style="btn-primary" id = "search1">
 	
	</select>


	<select class="selectpicker"  title = "second user" data-live-search="true" data-style="btn-success" id = "search2">
 	
	</select>

	<select class="selectpicker" title = "third user" data-live-search="true" data-style="btn-danger" id = "search3">
 	
	</select>
</div>
<div class = "container" id = "graph">
	
</div>
</div>
<script>
	//assume that the date range 
	var text = '{"employees":[' +'{"Name":"John"},' +'{"Name":"Anna"},' +'{"Name":"Peter"}]}';
	var timedate = {
		"John" : [{"date":"2016-02-29","totalNum":2},{"date":"2016-03-26","totalNum":1},{"date":"2016-03-29","totalNum":2}],
 	 	"Anna" : [{"date":"2016-02-29","totalNum":4},{"date":"2016-03-26","totalNum":5},{"date":"2016-03-29","totalNum":9}],
 	 	"Peter" : [{"date":"2016-02-29","totalNum":7},{"date":"2016-03-26","totalNum":2},{"date":"2016-03-29","totalNum":4}]
 	 };
	 console.log(timedate);
 	var obj = JSON.parse(text);

	var ids = ["nil","nil","nil"]; 
	var margin = {top: 20, right: 20, bottom: 100, left: 50},
    width = 960 - margin.left - margin.right,
    height = 500 - margin.top - margin.bottom;

    var valueline = d3.line()
		.x(function(d) { return x(d.date); })
		.y(function(d) { return y(d.totalNum); });

    var svg = d3.select("#graph").append("svg")
    			.attr("width", width + margin.left + margin.right)
    			.attr("height", height + margin.top + margin.bottom)
  				.append("g")
    			.attr("transform","translate(" + margin.left + "," + margin.top + ")");

    var parseTime = d3.timeParse("%Y-%m-%d");
    var mindate = parseTime(timedate.John[0].date);
    var maxdate = parseTime(timedate.John[2].date);
    console.log('maxdate: ', maxdate);
    var x = d3.scaleTime().domain([mindate,maxdate]).range([0, width]);
	var y = d3.scaleLinear().domain([0,10]).range([height, 0]);

	svg.append("g")
      .attr("transform", "translate(0," + height + ")")
      .call(d3.axisBottom(x));

     svg.append("g")
      .call(d3.axisLeft(y));

	for (i = 0; i < obj.employees.length; i++) { 
 		      var search1 = document.getElementById("search1");
 		      var search2 = document.getElementById("search2");
    		  var search3 = document.getElementById("search3");
    		  var option1 = document.createElement("option");
    		  var option2 = document.createElement("option");
    		  var option3 = document.createElement("option");
    		  option1.text = obj.employees[i].Name;
    		  option2.text = obj.employees[i].Name;
    		  option3.text = obj.employees[i].Name;
    		  option1.value = obj.employees[i].Name;
    		  option2.value = obj.employees[i].Name;
    		  option3.value = obj.employees[i].Name;
    		  search1.add(option1);
    		  search2.add(option2);
    		  search3.add(option3);
	}
	
	

	$(document).ready(function() {
   		$("#search1").change(function(){
        	var name = $("#search1").val();
	        var toDraw = timedate[name];
	        drawLine(toDraw,"blue","#first",0);
	        ids[0] = "#first";
    	});

  		$("#search2").change(function() {
        	var name = $("#search2").val();
        	var toDraw = timedate[name];
        	drawLine(toDraw,"green","#second",1);
    		ids[1] = "#second";
    	});

   		$("#search3").change(function() {
        	var name = $("#search3").val();
        	var toDraw = timedate[name];
        	drawLine(toDraw,"red","#third",2);
    		ids[2] = "#third";
    	});
	});
	// $(document).ready(function(){
 //   		$("#search2").change(function(){
 //        	var name = $("#search2").val();
 //        	var toDraw = timedate[name];
 //        	drawLine(toDraw,"green","#second",1);
 //    		ids[1] = "#second";
 //    	});
	// });
	// $(document).ready(function(){

	// });


	function drawLine(linedate,color,id,idspos) {
		if(ids[idspos] != "nil"){
        	document.getElementById(id).remove();
        } 	

		// var temp = Object.assign([],linedate);
		var temp = [];		
		linedate.forEach(function(d) {
			var tempD = Object.assign({}, d);
			tempD.date = parseTime(tempD.date);
			console.log(d.date+"hahah");
			tempD.totalNum = tempD.totalNum;
			console.log(d.totalNum+"hehehe");
			temp.push(tempD);
		});
    
	  	svg.append("path")
	  		.attr("d", valueline(temp))
	       	.attr("stroke", color)
	       	.attr("stroke-width", 2)
	        .attr("fill", "none")
	        .attr("id",id);
	}	

</script>
</body>